CC = @CC@
CFLAGS = @CFLAGS@ @CWFLAG@ -I./include
# -DDEBUG
AR = ar -cur
RANLIB = @RANLIB@
RM = rm -f
STRIP = strip
LIBS =
# -lefence
EXT =
SUBMAKE_COMM = cd lib ; $(MAKE)

EXECS = install-memo$(EXT) install-user$(EXT)\
		install-todos$(EXT) read-ical$(EXT)\
		sync-memodir$(EXT) sync-ical$(EXT)\
		pilot-xfer$(EXT) pilot-file$(EXT)\
	    reminders$(EXT) memos$(EXT) addresses$(EXT) read-todos$(EXT)\
		test-connector$(EXT) test-acceptor$(EXT) debugsh$(EXT) dlpsh$(EXT)

all: submake $(EXECS)

submake lib/libpisock.a:
	$(SUBMAKE_COMM)

libpisock.a: lib/libpisock.a
	cp lib/libpisock.a libpisock.a

install-memo$(EXT): libpisock.a install-memo.o
	$(CC) $(CFLAGS) install-memo.o libpisock.a -o $@ $(LIBS)

install-todos$(EXT): libpisock.a install-todos.o
	$(CC) $(CFLAGS) install-todos.o libpisock.a -o $@ $(LIBS)

install-user$(EXT): libpisock.a install-user.o
	$(CC) $(CFLAGS) install-user.o libpisock.a -o $@ $(LIBS)

pilot-xfer$(EXT): libpisock.a pilot-xfer.o
	$(CC) $(CFLAGS) pilot-xfer.o libpisock.a -o $@ $(LIBS)

pilot-file$(EXT): libpisock.a pilot-file.o
	$(CC) $(CFLAGS) pilot-file.o libpisock.a -o $@ $(LIBS)

reminders$(EXT): libpisock.a reminders.o
	$(CC) $(CFLAGS) reminders.o libpisock.a -o $@ $(LIBS)

memos$(EXT): libpisock.a memos.o
	$(CC) $(CFLAGS) memos.o libpisock.a -o $@ $(LIBS)

read-todos$(EXT): libpisock.a read-todos.o
	$(CC) $(CFLAGS) read-todos.o libpisock.a -o $@ $(LIBS)

read-ical$(EXT): libpisock.a read-ical.o
	$(CC) $(CFLAGS) read-ical.o libpisock.a -o $@ $(LIBS)

sync-memodir$(EXT): libpisock.a sync-memodir.o
	$(CC) $(CFLAGS) sync-memodir.o libpisock.a -o $@ $(LIBS)

sync-ical$(EXT): libpisock.a sync-ical.o
	$(CC) $(CFLAGS) sync-ical.o libpisock.a -o $@ $(LIBS)

addresses$(EXT): libpisock.a addresses.o
	$(CC) $(CFLAGS) addresses.o libpisock.a -o $@ $(LIBS)

test-connector$(EXT): libpisock.a test-connector.o
	$(CC) $(CFLAGS) test-connector.o libpisock.a -o $@ $(LIBS)

test-acceptor$(EXT): libpisock.a test-acceptor.o
	$(CC) $(CFLAGS) test-acceptor.o libpisock.a -o $@ $(LIBS)

dlpsh$(EXT): libpisock.a dlpsh.o
	$(CC) $(CFLAGS) dlpsh.o libpisock.a -o $@ $(LIBS)

debugsh$(EXT): libpisock.a debugsh.o
	$(CC) $(CFLAGS) debugsh.o libpisock.a -o $@ $(LIBS)
	
strip: $(EXECS)
	$(STRIP) $(EXECS)

distclean: clean
	$(SUBMAKE_COMM) depend
	$(RM) Makefile lib/Makefile lib/Makefile.in~ include/pi-config.h
	$(RM) config.*
	perl os2dist.pl

clean:
	$(RM) *.o *.a *~ core a.out test_s test_c install-prc$(EXT) 
	$(RM) $(EXECS)
	$(RM) include/*~ man/*~ *.orig include/*.orig
	$(SUBMAKE_COMM) clean
